#!/usr/bin/env zsh

set -eo pipefail

# HELP: set up your computer to allow a remote pair partner to join temporarily. Defaults to getting the ssh public for a user from github. Add a get_ssh_public_key_from_username command for custom ssh keys if github will not work for that user.

if [[ -n "$1" ]]; then
  USER_CSV_STRING="$1"
  echo "allow pair access for bitbucket server user: ${USER_CSV_STRING}"
else
  USER_CSV_STRING="${NO_TERM_LIMITS_DEFAULT_PAIR_USER_CSV_STRING}"
  echo "defaulting to allowing pair access for bitbucket server user: ${USER_CSV_STRING}"
fi

function create_stuff() {
  user_array=("${(@s/,/)USER_CSV_STRING}")
  for pair_user in ${user_array} ; do
    create_wemux_user "$pair_user"
  done
}

install_and_configure_wemux
stop_pairing

rm /var/tmp/no_term_limits_wemux_ssh_users
rm -rf /tmp/superawesomestuffthatisgreat
create_stuff

# none of this works without ssh access
if is_mac; then
  sudo launchctl load -w /System/Library/LaunchDaemons/ssh.plist
fi

get_pair_command
